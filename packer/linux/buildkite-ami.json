{
    "variables": {
        "region": "us-east-1",
        "arch": "x86_64",
        "goarch": "amd64",
        "instance_type": "m5.xlarge"
    },

    "builders": [
        {
            "type": "qemu",
            "ssh_username": "ec2-user",
            "ssh_password": "ppp",
            "iso_url": "https://cdn.amazonlinux.com/os-images/2.0.20221004.0/kvm/amzn2-kvm-2.0.20221004.0-x86_64.xfs.gpt.qcow2",
            "iso_checksum": "69f560586d0d454eb60779ba3e37eacee7dbe8d25560b57bb17306ff405004e2",
            "accelerator": "kvm",
            "disk_image": true,
            "format": "qcow2",
            "cd_files": ["./user-data", "./meta-data"],
            "cd_label": "cidata",
            "memory": 5120
        }
    ],
    "provisioners": [
        {
            "type": "file",
            "source": "conf",
            "destination": "/tmp"
        },
        {
            "type": "file",
            "source": "../../plugins",
            "destination": "/tmp/plugins"
        },
        {
            "type": "shell",
            "script": "scripts/install-utils.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-cloudwatch-agent.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-lifecycled.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-docker.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-buildkite-agent.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-s3secrets-helper.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-git-lfs.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-session-manager-plugin.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-nvme-cli.sh"
        },
        {
            "type": "shell",
            "script": "scripts/install-nix.sh"
        },
        {
            "type": "shell",
            "inline": ["rm /home/ec2-user/.ssh/authorized_keys"]
        }
    ]
}
